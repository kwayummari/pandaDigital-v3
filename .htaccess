# -----------------------------------------
# .htaccess for Vanilla PHP, JS, HTML, CSS Website
# -----------------------------------------

# 1. Force HTTPS
RewriteEngine On
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# 2. Prevent Directory Browsing
Options -Indexes

# 3. Remove Server Signature
ServerSignature Off

# 4. XSS Protection
Header set X-XSS-Protection "1; mode=block"
Header set X-Content-Type-Options "nosniff"

# 5. Prevent Clickjacking
Header always append X-Frame-Options "SAMEORIGIN"

# 6. Prevent MIME-type sniffing
Header set X-Content-Type-Options "nosniff"

# 7. HTTP Strict Transport Security (HSTS)
Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" env=HTTPS

# 8. GZIP Compression for speed
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json application/xml
</IfModule>

# 9. Leverage Browser Caching
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/pdf "access plus 1 month"
  ExpiresByType text/javascript "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType application/x-javascript "access plus 1 month"
  ExpiresByType application/font-woff2 "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType application/font-woff "access plus 1 year"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
  ExpiresByType font/ttf "access plus 1 year"
  ExpiresByType font/otf "access plus 1 year"
  ExpiresDefault "access plus 2 days"
</IfModule>

# 10. Remove ETag for better caching
Header unset ETag
FileETag None

# 11. Prevent Trace/Track Methods
RewriteCond %{REQUEST_METHOD} ^(TRACE|TRACK)
RewriteRule .* - [F]

# 12. Prevent Access to Sensitive Files (.env, config, etc)
<FilesMatch "^\.env">
  Order allow,deny
  Deny from all
</FilesMatch>
<FilesMatch "(^\.|wp-config\.php|config\.js|config\.json|config\.php)">
  Order allow,deny
  Deny from all
</FilesMatch>

# 13. Block access to .git and .svn folders
RedirectMatch 404 /\.git
RedirectMatch 404 /\.svn

# 14. Prevent Access to Backup and Source Files
<FilesMatch "(^#.*#|\.(bak|config|sql|fla|psd|ini|log|sh|inc|swp|dist)|~)$">
  Order allow,deny
  Deny from all
</FilesMatch>

# 15. Limit HTTP Methods to GET, POST, OPTIONS
<LimitExcept GET POST OPTIONS>
  Deny from all
</LimitExcept>

# 16. Prevent attackers from uploading new files or creating folders via web
# (Assumes no legitimate file upload functionality is needed)
<Directory "/">
  <LimitExcept GET POST OPTIONS>
    Deny from all
  </LimitExcept>
</Directory>

# 17. Block common malicious User Agents (but allow Google and Bing)
SetEnvIfNoCase User-Agent "libwww-perl" bad_bot
Deny from env=bad_bot

# 18. Prevent image hotlinking (optional, replace domain.com)
#RewriteCond %{HTTP_REFERER} !^$
#RewriteCond %{HTTP_REFERER} !^https://(www\.)?domain\.com/ [NC]
#RewriteRule \.(jpg|jpeg|png|gif)$ - [F]

# -----------------------------------------
# End of .htaccess (PHP)
# -----------------------------------------
